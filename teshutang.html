<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catatan Hutang</title>

<style>
    body {
        font-family: system-ui, sans-serif;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        background: #f8fafc;
    }
    h1 { margin-bottom: 6px; }
    .card {
        background: white;
        border-radius: 10px;
        padding: 16px;
        margin-top: 16px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    table {
        width: 100%; border-collapse: collapse; margin-top: 10px;
    }
    th, td {
        border: 1px solid #e5e7eb; padding: 8px;
    }
    th { background: #f1f5f9; }
    .progress-container {
        width: 100%;
        background: #e2e8f0;
        border-radius: 20px;
        margin-top: 10px;
    }
    .progress-bar {
        height: 20px;
        background: #10b981;
        border-radius: 20px;
        width: 0%;
        transition: width .4s ease;
    }
</style>
</head>
<body>

<h1>ðŸ“˜ Catatan Hutang</h1>
<div id="status">Mengambil data...</div>

<div id="summary" class="card"></div>

<h2>Daftar Barang Hutang</h2>
<div id="hutangTable" class="card"></div>

<h2>Riwayat Cicilan</h2>
<div id="cicilanTable" class="card"></div>

<script>
const BASE = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTz5Zo8oT3nuDLRZJhh0tqzTRfYWvCQCPjkOnAO5vBb4DTOosHMWzQyMLy3aKZW4XLASn2R4AiTC6Bj/pub?gid=";
const CSV = "&single=true&output=csv";

// GID sheet
const GID_HUTANG = "0";        // DataHutang
const GID_CICILAN = "1090039187"; // CicilanHutang (dari screenshot Anda)

async function getCSV(url){
    let r = await fetch(url);
    let t = await r.text();
    return t.trim().split(/\r?\n/).map(row => row.split(","));
}

function tableHTML(data){
    let [h, ...rows] = data;
    let html = "<table><thead><tr>";
    h.forEach(th => html += `<th>${th}</th>`);
    html += "</tr></thead><tbody>";

    rows.forEach(r=>{
        if(r.every(x=>x==="")) return;
        html += "<tr>" + r.map(c=>`<td>${c}</td>`).join("") + "</tr>";
    });

    html += "</tbody></table>";
    return html;
}

function formatRupiah(n){
    return Number(n).toLocaleString("id-ID");
}

(async()=>{
    const status = document.getElementById("status");
    try{
        status.innerHTML = "Mengambil data hutang & cicilan...";

        const hutang = await getCSV(BASE+GID_HUTANG+CSV);
        const cicilan = await getCSV(BASE+GID_CICILAN+CSV);

        document.getElementById("hutangTable").innerHTML = tableHTML(hutang);
        document.getElementById("cicilanTable").innerHTML = tableHTML(cicilan);

        // Hitung total hutang
        let hutangRows = hutang.slice(1);
        let totalHutang = hutangRows.reduce((s,r)=> s + Number(r[2]||0), 0);

        // Hitung total cicilan
        let cicilanRows = cicilan.slice(1);
        let totalBayar = cicilanRows.reduce((s,r)=> s + Number(r[2]||0), 0);

        let sisa = totalHutang - totalBayar;
        let persen = (totalBayar / totalHutang) * 100;

        document.getElementById("summary").innerHTML = `
            <b>Total Hutang:</b> Rp ${formatRupiah(totalHutang)} <br>
            <b>Total Cicilan Dibayar:</b> Rp ${formatRupiah(totalBayar)} <br>
            <b>Sisa Hutang:</b> Rp ${formatRupiah(sisa)} <br><br>
            
            <div class="progress-container">
                <div class="progress-bar" style="width:${persen}%"></div>
            </div>
            <small>Progress Pelunasan: ${persen.toFixed(1)}%</small>
        `;

        status.innerHTML = "Data berhasil dimuat.";

    }catch(e){
        status.innerHTML = "Gagal memuat data: " + e.message;
    }
})();
</script>

</body>
</html>
